CREATE DATABASE ORDER2
USE ORDER2
CREATE TABLE CUSTOMER(
CUSTID INT,
CNAME VARCHAR(10),
CITY VARCHAR(10),
PRIMARY KEY(CUSTID)
)
INSERT INTO CUSTOMER VALUES (1,'TOM','UDUPI')
INSERT INTO CUSTOMER VALUES (2,'RAM','BNGLR')
INSERT INTO CUSTOMER VALUES (3,'SEETHA','MNGLR')
INSERT INTO CUSTOMER VALUES (4,'JIM','HUBLI')
INSERT INTO CUSTOMER VALUES (5,'JOHN','GADAG')
SELECT * FROM CUSTOMER
CREATE TABLE C_ORDER(
ORDERID INT,
ODATE DATE,
CUSTID INT,
ORDAMT INT,
PRIMARY KEY(ORDERID),
FOREIGN KEY(CUSTID) REFERENCES CUSTOMER(CUSTID) ON DELETE CASCADE ON UPDATE
CASCADE
)
INSERT INTO C_ORDER VALUES(101,'2020-11-10',1,NULL)
INSERT INTO C_ORDER VALUES(102,'2020-12-10',1,NULL)
INSERT INTO C_ORDER VALUES(103,'2004-11-10',2,NULL)
INSERT INTO C_ORDER VALUES(104,'2020-11-10',3,NULL)
INSERT INTO C_ORDER VALUES(105,'2004-11-10',4,NULL)
SELECT*FROM C_ORDER
CREATE TABLE ITEM(
ITEMID INT,
PRICE INT,
PRIMARY KEY(ITEMID)
)
INSERT INTO ITEM VALUES(21,40)
INSERT INTO ITEM VALUES(22,50)
INSERT INTO ITEM VALUES(23,60)
INSERT INTO ITEM VALUES(24,70)
INSERT INTO ITEM VALUES(25,20)
SELECT*FROM ITEM
CREATE TABLE ORDERITEM(
ORDERID INT,
ITEMID INT,
QTY INT,
PRIMARY KEY(ORDERID,ITEMID),
FOREIGN KEY(ORDERID) REFERENCES C_ORDER(ORDERID) ON DELETE CASCADE ON UPDATE
CASCADE,
FOREIGN KEY(ITEMID) REFERENCES ITEM(ITEMID) ON DELETE CASCADE ON UPDATE
CASCADE
)
INSERT INTO ORDERITEM VALUES(101,21,2)
INSERT INTO ORDERITEM VALUES(101,22,3)
INSERT INTO ORDERITEM VALUES(102,23,2)
INSERT INTO ORDERITEM VALUES(102,24,1)
INSERT INTO ORDERITEM VALUES(102,25,2)
INSERT INTO ORDERITEM VALUES(103,21,2)
INSERT INTO ORDERITEM VALUES(105,21,5)
INSERT INTO ORDERITEM VALUES(104,25,2)
INSERT INTO ORDERITEM VALUES(105,23,2)
SELECT * FROM ORDERITEM
CREATE TABLE WAREHOUSE(
WARID INT,
CITY VARCHAR(10),
PRIMARY KEY(WARID)
)
INSERT INTO WAREHOUSE VALUES(201,'UDUPI')
INSERT INTO WAREHOUSE VALUES(202,'UDUPI2')
INSERT INTO WAREHOUSE VALUES(203,'UDUPI3')
INSERT INTO WAREHOUSE VALUES(204,'UDUPI4')
INSERT INTO WAREHOUSE VALUES(205,'UDUPI5')
SELECT * FROM WAREHOUSE
CREATE TABLE SHIPMENT(
ORDERID INT,
WARID INT,
SHIPDATE DATE,
PRIMARY KEY(ORDERID,WARID),
FOREIGN KEY(ORDERID) REFERENCES C_ORDER(ORDERID) ON DELETE CASCADE ON UPDATE
CASCADE,
FOREIGN KEY(WARID) REFERENCES WAREHOUSE(WARID) ON DELETE CASCADE ON UPDATE
CASCADE
)
INSERT INTO SHIPMENT VALUES(101,201,'1090-09-17')
INSERT INTO SHIPMENT VALUES(101,202,'1091-09-17')
INSERT INTO SHIPMENT VALUES(101,203,'1090-08-17')
INSERT INTO SHIPMENT VALUES(103,201,'1090-09-10')
INSERT INTO SHIPMENT VALUES(103,202,'1070-09-17')
INSERT INTO SHIPMENT VALUES(105,201,'1090-05-17')
INSERT INTO SHIPMENT VALUES(102,204,'1098-09-17')
INSERT INTO SHIPMENT VALUES(102,201,'1090-09-17')
INSERT INTO SHIPMENT VALUES(102,201,'1090-09-17')
INSERT INTO SHIPMENT VALUES(104,201,'1090-09-17')
SELECT*FROM SHIPMENT
UPDATE C_ORDER SET ORDAMT=(SELECT SUM(O.QTY*I.PRICE) FROM ORDERITEM O,ITEM I 
WHERE O.ITEMID=I.ITEMID AND O.ORDERID=101)WHERE ORDERID=101
UPDATE C_ORDER SET ORDAMT=(SELECT SUM(O.QTY*I.PRICE) FROM ORDERITEM O,ITEM I 
WHERE O.ITEMID=I.ITEMID AND O.ORDERID=102)WHERE ORDERID=102
UPDATE C_ORDER SET ORDAMT=(SELECT SUM(O.QTY*I.PRICE) FROM ORDERITEM O,ITEM I 
WHERE O.ITEMID=I.ITEMID AND O.ORDERID=103)WHERE ORDERID=103
UPDATE C_ORDER SET ORDAMT=(SELECT SUM(O.QTY*I.PRICE) FROM ORDERITEM O,ITEM I 
WHERE O.ITEMID=I.ITEMID AND O.ORDERID=104)WHERE ORDERID=104
UPDATE C_ORDER SET ORDAMT=(SELECT SUM(O.QTY*I.PRICE) FROM ORDERITEM O,ITEM I 
WHERE O.ITEMID=I.ITEMID AND O.ORDERID=105)WHERE ORDERID=105
SELECT * FROM C_ORDER
#1
SELECT C.CNAME AS CUSTNAME,COUNT(DISTINCT O.ORDERID) AS
#OFORDERS,AVG(O.ORDAMT) AS AVG_ORDER_AMT 
FROM CUSTOMER C,C_ORDER O
WHERE C.CUSTID=O.CUSTID
GROUP BY O.CUSTID,C.CNAME
#2
SELECT OI.ITEMID,COUNT(OI.ORDERID),SUM(OI.QTY)
FROM ORDERITEM OI
WHERE OI.ORDERID IN(SELECT S.ORDERID
 FROM SHIPMENT S
 GROUP BY S.ORDERID
HAVING COUNT(DISTINCT S.WARID)>=2)
 AND OI.ITEMID IN(SELECT ITEMID
 FROM ORDERITEM
 GROUP BY ITEMID
 HAVING COUNT(ORDERID)>2)
 GROUP BY OI.ITEMID
#3
SELECT C.CNAME
FROM CUSTOMER C
WHERE NOT EXISTS(SELECT I.ITEMID
 FROM ITEM I
 WHERE NOT EXISTS(SELECT O.ORDERID 
 FROM ORDERITEM O,C_ORDER C1
 WHERE C.CUSTID=C1.CUSTID AND I.ITEMID=O.ITEMID 
 AND O.ORDERID=C1.ORDERID))
# MODIFICATION: DISPLAY THE NAME AND NUMBER OF CUSTOMERS WHO PLACED ATLEAST 
TWO ORDERS IN THE YEAR 2020
SELECT C.CNAME AS CUSTOMER,COUNT(DISTINCT C.CUSTID) AS NO_OF_CUST
FROM CUSTOMER C,C_ORDER O
WHERE C.CUSTID=O.CUSTID AND YEAR(ODATE)='2020'
GROUP BY C.CNAME
HAVING COUNT(O.ORDERID)>=2
